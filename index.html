<!DOCTYPE html>
<html lang="pt-br">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numerologia Divina</title>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

</head>

<body>

    <h1>EM CONSTRUCAO</h1>

    <form>
        
        <div class="mb-3">
            <label for="data-nasc" class="form-label">Data de Nascimento:</label>
            <input type="tel" name="data-nasc" id="data-nasc" placeholder="DD/MM/AAAA" maxlength="10" size="10" required/> 
        </div>
        
        <button type="submit" class="btn btn-primary">Submit</button>
<!-- 
        <h3>Debug</h3>
        <p>Valor MVA</p>
        <p id="mva-debug-day"></p>
        <p id="mva-debug-month"></p>
        <p id="mva-debug-year"></p>
        <p>------</p>
        <p id="mva-debug-value"></p> -->
        <p>----------------------------------------</p>

    </form>

    <div class="row">
        <div class="col-md-6">
            <p><strong>Interno:</strong><i id="interno"></i></p> 
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <p><strong>Externo:</strong><i id="externo"></i></p> 
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <p><strong>Missao de Vida (MVA):</strong><i id="mva"></i></p> 
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <p><strong>Palavra:</strong><i id="palavra"></i></p> 
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <p><strong>ILKA:</strong><i id="ilka"></i></p> 
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <p><strong>Numerologia do dinheiro:</strong><i id="dinheiro"></i></p> 
        </div>
    </div>


</body>

<script>

    $(document).ready(function(){

        const _DOB = {
            "raw":"",
            "day":0,
            "daySplit":[],
            "month":0,
            "monthSplit":[],
            "year":0,
            "yearSplit":[],
            "year1":0,
            "year2":0,
            "year3":0,
            "year4":0,
            "mva":0,
            "ilka":0,
            "dob_elem": document.getElementById("data-nasc"),


        };

        _DOB.dob_elem.addEventListener("input", function(){
            _DOB.dob_elem.value = _DOB.dob_elem.value.replace(/^(\d\d)(\d)$/g,'$1/$2').replace(/^(\d\d\/\d\d)(\d+)$/g,'$1/$2').replace(/[^\d\/]/g,'');;
        });
        

        const interno = document.getElementById("interno");
        if(interno){
            interno.innerText = " testando" 
        }

        const externo = document.getElementById("externo");
        if(externo){
            externo.innerText = " testando2" 
        }

        const palavra = document.getElementById("palavra");
        if(palavra){
            palavra.innerText = " testando4" 
        }

        const dinheiro = document.getElementById("dinheiro");
        if(dinheiro){
            dinheiro.innerText = " testando6" 
        }

        function getNumFinancial(){
            
        }

        function formatDateNumbers(value){

            const [day, month, year] = value.split('/');
            const date = `${year}-${month}-${day}`;

            return date; 

        }
        
        function getDateOfBirth(){

            //const dobRaw = document.getElementById("data-nasc");
            const dobRaw = _DOB.dob_elem;
            if(dobRaw){

                const date = formatDateNumbers(dobRaw.value);

                _DOB.raw = new Date(date);
                _DOB.day = _DOB.raw.getDate().toString();
                _DOB.month = (_DOB.raw.getMonth() + 1).toString();
                _DOB.year = _DOB.raw.getFullYear().toString();

                _DOB.year1 =  parseInt(_DOB.year.toString().substring(0,1));
                _DOB.year2 =  parseInt(_DOB.year.toString().substring(1,2));
                _DOB.year3 =  parseInt(_DOB.year.toString().substring(2,3));
                _DOB.year4 =  parseInt(_DOB.year.toString().substring(3,4));

                if(_DOB.day >= 10){
                    _DOB.daySplit = _DOB.day.toString().split('');
                }

                if(_DOB.month >= 10){
                    _DOB.monthSplit = _DOB.month.toString().split('');
                }

                if(_DOB.year){
                    _DOB.yearSplit = _DOB.year.toString().split('');
                }
                
            }

            return _DOB;

        }

        function getInternal(){

        }

        function getExternal(){

        }

        function getCorrectValueForMVA(value){
            let newValue = 0;
            if(value >= 23){
                const splitNums = value.toString().split(''); 
                newValue = parseInt(splitNums[0]) + parseInt(splitNums[1]);
            }else{
                newValue = parseInt(value);
            }

            return newValue;
        }

        function getMVA(dob){
            
            let valueDay = getCorrectValueForMVA(dob.day);
            let valueMonth = getCorrectValueForMVA(dob.month);

            let valueYear = dob.year1 + dob.year2 + dob.year3 + dob.year4;
            let newValueYear = getCorrectValueForMVA(valueYear);

            if(dob.day < 10){
                dob.daySplit[0] = 0;
                dob.daySplit[1] = dob.day;
            }

            if(dob.month < 10){
                dob.monthSplit[0] = 0;
                dob.monthSplit[1] = dob.month;
            }

            const col4 = parseInt(dob.daySplit[1]) + parseInt(dob.monthSplit[1]) + parseInt(dob.yearSplit[3]);
            const col3 = parseInt(dob.daySplit[0]) + parseInt(dob.monthSplit[0]) + parseInt(dob.yearSplit[2]);
            const col2 = parseInt(dob.yearSplit[1]);
            const col1 = parseInt(dob.yearSplit[0]);

            const sumOfSplittedDate = col1 + col2 + col3 + col4;

            dob.mva = getCorrectValueForMVA(sumOfSplittedDate);
            
            const mvaElem = document.getElementById("mva");
           
            // Arcane
            const arcane = getArcane(dob.mva);

            if(mvaElem){
                mva.innerText = ` ${dob.mva} - ${arcane ? arcane.name : ""}`; 
            }


            //ILKA
            const sumIlka = valueYear + valueDay + valueMonth + dob.mva;

            getILKA(sumIlka);
            
            //debug
           /*  document.getElementById("mva-debug-day").innerHTML = `Valor Dia ${valueDay}`;
            document.getElementById("mva-debug-month").innerHTML = `Valor Mes ${valueMonth}`;
            document.getElementById("mva-debug-year").innerHTML = `Valor Ano ${valueYear}`;

            document.getElementById("mva-debug-value").innerHTML = `Resultado ${sumIlka}`;
 */


        }

        function getWord(){
            //Codigos da Vida - Palavra Chave

        }

        function getILKA(sumIlka){

            const ilka = document.getElementById("ilka");
            if(ilka){
                ilka.innerText = ` ${sumIlka}` 
            }




        }

        function getArcane(number){
            const arcane = arcanes.find(({num}) => num === number);
            return arcane;

        }

        function startProcess(){

            const dob = getDateOfBirth();

            if(!dob){
               return false;
            }

            getMVA(dob);
           


        }

        $("form").submit(function(){

            startProcess();
           
            event.preventDefault();
        });
        

    })

    const codigosDaVida = 
        {
            "1":"empreendedor",
            "2":"intuitivo",
            "3":"comunicador",
            "6":"familiar",
            "7":"conquistador",
            "8":"justo",
            "9":"paciente",


        };

   

    const arcanes = [
        {
            "num": 0,
            "name": "O Louco",
            "url_carta": "",
        },
        {
            "num": 4,
            "name": "O Imperador",
            "url_carta": "img/cards/o-imperador",
        },
        {
            "num": 8,
            "name": "A For√ßa",
            "url_carta": "",
        },
        {
            "num": 9,
            "name": "O Eremita",
            "url_carta": "",
        },
        {
            "num": 10,
            "name": "A Roda da Fortuna",
            "url_carta": "",
        },
        {
            "num": 16,
            "name": "A Torre",
            "url_carta": "",
        },
        {
            "num": 17,
            "name": "A Estrela",
            "url_carta": "",
        },

    ];
  

</script>
</html>